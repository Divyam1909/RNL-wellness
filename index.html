<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ritesh Natural Life Wellness</title>
    <!-- Tailwind CSS for modern layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <!-- Google Fonts: Merriweather for headings (Ayurvedic feel), Open Sans for text -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom Theme Overrides - Light Mode */
        :root {
            --primary-green: #2F5233;
            --accent-gold: #D4AF37;
            --light-bg: #F9F7F2;
            --text-dark: #333333;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --search-bg: #ffffff;
            --footer-bg: #2F5233;
        }

        /* Dark Mode Variables */
        .dark {
            --primary-green: #4ade80;
            --accent-gold: #fbbf24;
            --light-bg: #0f172a;
            --text-dark: #f1f5f9;
            --card-bg: #1e293b;
            --border-color: #334155;
            --search-bg: #1e293b;
            --footer-bg: #0f172a;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-dark);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3, h4, .serif {
            font-family: 'Merriweather', serif;
        }

        /* Scrollbar aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .dark ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .hero-pattern {
            background-color: #2F5233;
            background-image: url("https://www.transparenttextures.com/patterns/leaf.png");
        }
        
        .dark .hero-pattern {
            background-color: #1e3a20;
        }

        /* Theme transition */
        .theme-transition {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header / Navbar -->
    <header id="main-header" class="fixed top-0 w-full z-40 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="leaf" class="text-[#2F5233] dark:text-green-400 h-8 w-8"></i>
                <h1 class="text-lg md:text-xl font-bold text-[#2F5233] dark:text-green-400 leading-none tracking-tight whitespace-nowrap">
                    Ritesh Natural Life Wellness
                </h1>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- Dark Mode Toggle -->
                <button onclick="toggleTheme()" id="theme-toggle" class="p-2 hover:bg-green-50 dark:hover:bg-slate-700 rounded-full transition-colors" title="Toggle theme">
                    <i data-lucide="sun" class="h-5 w-5 text-[#2F5233] dark:text-green-400 hidden dark:block"></i>
                    <i data-lucide="moon" class="h-5 w-5 text-[#2F5233] dark:text-green-400 block dark:hidden"></i>
                </button>
                
                <!-- Cart Icon -->
                <button onclick="toggleCart()" class="relative p-2 hover:bg-green-50 dark:hover:bg-slate-700 rounded-full transition-colors">
                    <i data-lucide="shopping-cart" class="text-[#2F5233] dark:text-green-400 h-6 w-6"></i>
                    <span id="cart-count" class="absolute top-0 right-0 bg-[#D4AF37] text-white text-xs font-bold px-1.5 py-0.5 rounded-full transform scale-0 transition-transform duration-200">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-pattern text-white mt-16 pt-16 pb-20 px-4 text-center">
        <div class="max-w-3xl mx-auto">
            <p class="text-[#D4AF37] font-semibold tracking-widest uppercase mb-2 text-sm">Ayurveda & Heritage</p>
            <h2 class="text-4xl md:text-5xl font-bold mb-4 serif">Wellness Begins Here</h2>
            <p class="text-green-100 text-lg md:text-xl font-light opacity-90">Restore your balance with our curated selection of 100% natural and organic remedies.</p>
        </div>
    </section>

    <!-- Product Catalog -->
    <main class="flex-grow container mx-auto px-4 py-12 -mt-10 z-10 relative">
        <!-- Search and Filter Section -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-md p-4 mb-8 border border-gray-100 dark:border-slate-700 theme-transition">
            <div class="flex flex-col md:flex-row gap-4">
                <!-- Search Bar -->
                <div class="relative flex-grow">
                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 dark:text-gray-500"></i>
                    <input type="text" id="search-input" placeholder="Search products..." 
                        class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2F5233] dark:focus:ring-green-500 focus:border-transparent bg-white dark:bg-slate-700 dark:text-white dark:placeholder-gray-400 transition-all">
                </div>
                <!-- Category Filter -->
                <div class="relative min-w-[200px]">
                    <select id="category-filter" 
                        class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2F5233] dark:focus:ring-green-500 focus:border-transparent appearance-none bg-white dark:bg-slate-700 dark:text-white cursor-pointer">
                        <option value="all">All Categories</option>
                        <option value="immunity">Immunity</option>
                        <option value="digestive">Digestive Health</option>
                        <option value="energy">Energy & Vitality</option>
                        <option value="skin">Skin & Beauty</option>
                        <option value="stress">Stress Relief</option>
                        <option value="detox">Detox & Cleanse</option>
                    </select>
                    <i data-lucide="chevron-down" class="absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 dark:text-gray-500 pointer-events-none"></i>
                </div>
            </div>
            <!-- Active filters display -->
            <div id="active-filters" class="hidden mt-3 flex items-center gap-2 flex-wrap">
                <span class="text-sm text-gray-500 dark:text-gray-400">Showing:</span>
                <span id="filter-badge" class="bg-[#2F5233] dark:bg-green-600 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1">
                    <span id="filter-text"></span>
                    <button onclick="clearFilters()" class="hover:bg-white/20 rounded-full p-0.5">
                        <i data-lucide="x" class="h-3 w-3"></i>
                    </button>
                </span>
                <span id="results-count" class="text-sm text-gray-500 dark:text-gray-400 ml-2"></span>
            </div>
        </div>
        
        <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Products will be injected here by JS -->
        </div>
        
        <!-- No results message -->
        <div id="no-results" class="hidden text-center py-16">
            <i data-lucide="search-x" class="h-16 w-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-300 mb-2">No products found</h3>
            <p class="text-gray-400 dark:text-gray-500 mb-4">Try adjusting your search or filter criteria</p>
            <button onclick="clearFilters()" class="text-[#2F5233] dark:text-green-400 font-semibold hover:underline">Clear all filters</button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#2F5233] dark:bg-slate-900 text-green-100 py-8 text-center mt-auto border-t border-green-800 dark:border-slate-700">
        <div class="container mx-auto px-4">
            <i data-lucide="flower-2" class="h-8 w-8 mx-auto mb-4 text-[#D4AF37]"></i>
            <h3 class="serif text-xl font-semibold mb-2">Ritesh Natural Life Wellness</h3>
            <p class="text-sm opacity-70 mb-4">Nature's best, curated for your health.</p>
            <p class="text-xs opacity-50">&copy; <script>document.write(new Date().getFullYear())</script> All rights reserved.</p>
        </div>
    </footer>

    <!-- Floating WhatsApp Button -->
    <div class="fixed bottom-6 right-6 z-40 flex flex-col items-end gap-2 group">
        <span class="bg-white dark:bg-slate-800 text-[#2F5233] dark:text-green-400 px-3 py-1.5 rounded-lg shadow-md text-sm font-semibold opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none mb-1">
            Chat with us on WhatsApp
        </span>
        <button onclick="openConsultation()" class="bg-[#25D366] hover:bg-[#128C7E] text-white p-4 rounded-full shadow-lg transition-all duration-200 hover:scale-105 flex items-center justify-center">
            <!-- WhatsApp SVG Icon -->
            <svg class="h-7 w-7" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
        </button>
    </div>

    <!-- User Info Modal -->
    <div id="user-info-modal" class="fixed inset-0 bg-black/50 z-[60] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div id="user-info-dialog" class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full transform scale-95 transition-transform duration-300 overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-[#2F5233] dark:bg-slate-900 text-white p-5 text-center">
                <i data-lucide="user-circle" class="h-12 w-12 mx-auto mb-2 text-[#D4AF37]"></i>
                <h3 class="serif text-xl font-bold">Just a moment!</h3>
                <p class="text-green-100 text-sm mt-1">Please share your details for personalized service</p>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6">
                <form id="user-info-form" class="space-y-4">
                    <div>
                        <label for="user-name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Your Name *</label>
                        <input type="text" id="user-name" required placeholder="Enter your full name" 
                            class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2F5233] dark:focus:ring-green-500 focus:border-transparent bg-white dark:bg-slate-700 dark:text-white transition-all">
                    </div>
                    <div>
                        <label for="user-age" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Your Age *</label>
                        <input type="number" id="user-age" required min="1" max="120" placeholder="Enter your age" 
                            class="w-full px-4 py-3 border border-gray-200 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2F5233] dark:focus:ring-green-500 focus:border-transparent bg-white dark:bg-slate-700 dark:text-white transition-all">
                    </div>
                    
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="closeUserInfoModal()" 
                            class="flex-1 px-4 py-3 border-2 border-gray-200 dark:border-slate-600 text-gray-600 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                            class="flex-1 px-4 py-3 bg-[#25D366] hover:bg-[#128C7E] text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2">
                            <span>Continue</span>
                            <i data-lucide="arrow-right" class="h-4 w-4"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cart Modal Overlay -->
    <div id="cart-modal" class="fixed inset-0 bg-black/50 z-50 hidden opacity-0 transition-opacity duration-300">
        <!-- Cart Drawer -->
        <div id="cart-drawer" class="fixed right-0 top-0 h-full w-full max-w-md bg-white dark:bg-slate-800 shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col">
            
            <!-- Drawer Header -->
            <div class="bg-[#2F5233] dark:bg-slate-900 text-white p-4 flex justify-between items-center shadow-md">
                <h3 class="serif text-xl font-bold flex items-center gap-2">
                    <i data-lucide="shopping-cart" class="h-5 w-5"></i> Your Cart
                </h3>
                <button onclick="toggleCart()" class="hover:bg-white/20 p-1 rounded-full transition">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>

            <!-- Cart Items Area -->
            <div id="cart-items-container" class="flex-grow overflow-y-auto p-4 space-y-4 bg-[#F9F7F2] dark:bg-slate-900">
                <!-- Cart items injected here -->
                <div class="text-center text-gray-400 dark:text-gray-500 mt-20 flex flex-col items-center">
                    <i data-lucide="shopping-cart" class="h-12 w-12 mb-2 opacity-50"></i>
                    <p>Your cart is empty.</p>
                </div>
            </div>

            <!-- Drawer Footer -->
            <div class="bg-white dark:bg-slate-800 p-4 border-t border-gray-100 dark:border-slate-700 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <div class="flex justify-between items-center mb-4 text-lg font-bold text-[#2F5233] dark:text-green-400">
                    <span>Total Estimate</span>
                    <span id="cart-total">‚Çπ0</span>
                </div>
                <button onclick="placeOrder()" class="w-full bg-[#2F5233] dark:bg-green-600 hover:bg-[#1e3a20] dark:hover:bg-green-700 text-white font-bold py-4 rounded-lg flex justify-center items-center gap-2 transition-colors">
                    <span>Place Order on WhatsApp</span>
                    <i data-lucide="send" class="h-4 w-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // ==========================================
        // CONFIGURATION SECTION - EDIT THIS
        // ==========================================
        
        // 1. WhatsApp Phone Number (Country code + Number, no + sign)
        const WA_PHONE = "919661660000"; 

        // 2. Custom Messages
        const MSG_ORDER_PREFIX = "Namaste Dr. Ritesh, I would like to place an order for the following items:";
        const MSG_CONSULT = "Namaste Dr. Ritesh, I am browsing your catalog and would like to consult with you.";

        // 3. Currency Symbol
        const CURRENCY = "‚Çπ";

        // 4. Product Catalog Data
        const products = [
            {
                id: 1,
                name: "Curcumin Capsule",
                price: 450,
                desc: "Pure turmeric extract with powerful anti-inflammatory and antioxidant properties for joint health and immunity.",
                category: "immunity",
                image: "https://lh3.googleusercontent.com/d/1AekaW97hvg6r3Ns7KyLOmo_75JajGkGi"
            },
            {
                id: 2,
                name: "Eco Ensulin Capsule",
                price: 450,
                desc: "Natural blood sugar management formula with herbal extracts to support healthy glucose metabolism.",
                category: "energy",
                image: "https://lh3.googleusercontent.com/d/12vIqq4F7AFBRe5OdQ_hVbO7KeWRGOXU0"
            },
            {
                id: 3,
                name: "Wheat Grass Capsule",
                price: 450,
                desc: "Nutrient-dense superfood rich in chlorophyll for detoxification, alkalizing, and boosting energy levels.",
                category: "detox",
                image: "https://lh3.googleusercontent.com/d/1NezPYO7NFa-UxtqOFvjSJzCGyWuPhzDL"
            },
            {
                id: 4,
                name: "Neem Capsule",
                price: 450,
                desc: "Traditional blood purifier with antibacterial properties for clear skin and strong immunity.",
                category: "immunity",
                image: "https://lh3.googleusercontent.com/d/1kpO9F3leQVCaMuIrQGMZ465Oj9w-VIm4"
            },
            {
                id: 5,
                name: "Sea Buckthorn Juice",
                price: 450,
                desc: "Himalayan superfruit juice packed with Omega-7, vitamins, and antioxidants for radiant skin and vitality.",
                category: "skin",
                image: "https://lh3.googleusercontent.com/d/12_K6hEIlNNP0zp8mt0bBStiqsuuDfyPh"
            },
            {
                id: 6,
                name: "Moringa Capsule",
                price: 450,
                desc: "The miracle tree supplement loaded with vitamins, minerals, and amino acids for complete nutrition.",
                category: "energy",
                image: "https://lh3.googleusercontent.com/d/1f2DoPjs_Ngn7zgDFUUxaApAc9NexuJ5V"
            },
            {
                id: 7,
                name: "Ashwagandha Capsule",
                price: 450,
                desc: "Adaptogenic herb for stress relief, mental clarity, improved sleep, and enhanced physical endurance.",
                category: "stress",
                image: "https://lh3.googleusercontent.com/d/1pF8aUa5DG3r4cYSH1BcHDW4vtIOQ_lam"
            },
            {
                id: 8,
                name: "Aloevera Juice",
                price: 450,
                desc: "Pure aloe vera extract for digestive health, skin hydration, and natural detoxification support.",
                category: "digestive",
                image: "https://lh3.googleusercontent.com/d/1HBkAnOS-SATTdozIMGpHhd1v7PUKWmlZ"
            },
            {
                id: 9,
                name: "Tulsi Capsule",
                price: 450,
                desc: "Holy basil extract for respiratory health, immunity boost, and natural stress management.",
                category: "immunity",
                image: "https://lh3.googleusercontent.com/d/1KMKCUlqmpfZfWRf7KBBLvlA1tfnb3miL"
            },
            {
                id: 10,
                name: "Spirulina Capsule",
                price: 450,
                desc: "Blue-green algae superfood rich in protein, B-vitamins, and iron for energy and detoxification.",
                category: "detox",
                image: "https://lh3.googleusercontent.com/d/1PW2UL7upDgJ5M8M7MKBDKKh6zZFXSUjD"
            },
            {
                id: 11,
                name: "Herbal Infusion Capsule",
                price: 720,
                desc: "Calming blend of traditional herbs for relaxation, better sleep, and digestive comfort.",
                category: "digestive",
                image: "https://lh3.googleusercontent.com/d/11HTvNjVqrMLsZq6Nrm-sJThKGcqt3Vza"
            },
            {
                id: 12,
                name: "Haridra Capsule",
                price: 750,
                desc: "Premium turmeric supplement for liver health, skin glow, and natural anti-inflammatory support.",
                category: "skin",
                image: "https://lh3.googleusercontent.com/d/1sX8Z77RzcyRrH0zJbjRRXCTTTSnNJbCN"
            },
            {
                id: 13,
                name: "Anjalika Capsule",
                price: 1300,
                desc: "Women's wellness formula supporting hormonal balance, vitality, and overall feminine health.",
                category: "energy",
                image: "https://lh3.googleusercontent.com/d/1HEH-p2rQzm2GtyZwHzh8H8jLdAPopU-I"
            }
        ];
        
        // Category labels for display
        const categoryLabels = {
            immunity: "Immunity",
            digestive: "Digestive Health",
            energy: "Energy & Vitality",
            skin: "Skin & Beauty",
            stress: "Stress Relief",
            detox: "Detox & Cleanse"
        };

        // ==========================================
        // APPLICATION LOGIC (Do not edit below)
        // ==========================================

        let cart = {}; // Object to store cart items: { productId: quantity }
        const CART_EXPIRY_HOURS = 168; // Cart data expires after 24 hours

        // Initialize Lucide Icons
        lucide.createIcons();
        
        // ==========================================
        // CART PERSISTENCE LOGIC
        // ==========================================
        
        function saveCart() {
            const cartData = {
                items: cart,
                timestamp: Date.now()
            };
            localStorage.setItem('rnl_cart', JSON.stringify(cartData));
        }
        
        function loadCart() {
            try {
                const savedCart = localStorage.getItem('rnl_cart');
                if (savedCart) {
                    const cartData = JSON.parse(savedCart);
                    const now = Date.now();
                    const hoursElapsed = (now - cartData.timestamp) / (1000 * 60 * 60);
                    
                    // Check if cart has expired
                    if (hoursElapsed < CART_EXPIRY_HOURS) {
                        cart = cartData.items || {};
                        updateCartUI();
                        console.log('Cart restored from previous session');
                    } else {
                        // Cart expired, clear it
                        clearCart();
                        console.log('Cart expired, starting fresh');
                    }
                }
            } catch (e) {
                console.error('Error loading cart:', e);
                clearCart();
            }
        }
        
        function clearCart() {
            cart = {};
            localStorage.removeItem('rnl_cart');
            updateCartUI();
        }
        
        // ==========================================
        // THEME TOGGLE LOGIC
        // ==========================================
        
        function initTheme() {
            // Check for saved theme preference or default to dark
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        }
        
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            lucide.createIcons(); // Refresh icons
        }
        
        // Initialize theme on load
        initTheme();

        // Render Products on Load
        const productGrid = document.getElementById('product-grid');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const activeFiltersDiv = document.getElementById('active-filters');
        const filterText = document.getElementById('filter-text');
        const resultsCount = document.getElementById('results-count');
        const noResultsDiv = document.getElementById('no-results');
        
        // Current filter state
        let currentSearch = '';
        let currentCategory = 'all';
        
        function renderProducts(filteredProducts = null) {
            const productsToRender = filteredProducts || products;
            
            if (productsToRender.length === 0) {
                productGrid.innerHTML = '';
                noResultsDiv.classList.remove('hidden');
                return;
            }
            
            noResultsDiv.classList.add('hidden');
            
            // Category colors - dark and visible
            const categoryColors = {
                immunity: 'bg-emerald-700',
                digestive: 'bg-amber-700',
                energy: 'bg-orange-700',
                skin: 'bg-pink-700',
                stress: 'bg-indigo-700',
                detox: 'bg-teal-700'
            };
            
            productGrid.innerHTML = productsToRender.map(product => {
                const qty = cart[product.id] || 0;
                const inCart = qty > 0;
                
                return `
                <div class="rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden flex flex-col h-full border-2 ${inCart ? 'border-[#D4AF37] ring-2 ring-[#D4AF37]/20' : 'border-[#D4AF37]/60 dark:border-[#D4AF37]/40'} hover:border-[#D4AF37] dark:hover:border-[#D4AF37] group bg-gradient-to-b from-white to-amber-50/30 dark:from-slate-800 dark:to-slate-900">
                    <div class="relative h-48 overflow-hidden">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        <span class="absolute top-3 left-3 ${categoryColors[product.category]} text-white text-xs font-bold px-2.5 py-1 rounded-md shadow-md">
                            ${categoryLabels[product.category]}
                        </span>
                        ${inCart ? `<span class="absolute top-3 right-3 bg-[#D4AF37] text-white text-xs font-bold px-2 py-1 rounded-md shadow-md flex items-center gap-1">
                            <i data-lucide="shopping-cart" class="h-3 w-3"></i> In Cart
                        </span>` : ''}
                    </div>
                    <div class="p-5 flex flex-col flex-grow backdrop-blur-sm bg-white/70 dark:bg-slate-800/70 border-t border-[#D4AF37]/20">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-[#2F5233] dark:text-green-400 leading-tight">${product.name}</h3>
                            <span class="bg-gradient-to-r from-amber-100 to-yellow-100 dark:from-amber-900/50 dark:to-yellow-900/50 text-[#996515] dark:text-amber-300 text-xs font-bold px-2.5 py-1 rounded-md shrink-0 ml-2 border border-[#D4AF37]/30">${CURRENCY}${product.price}</span>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 flex-grow font-light">${product.desc}</p>
                        
                        <!-- Quantity Controls -->
                        <div class="flex items-center gap-2">
                            ${inCart ? `
                                <div class="flex items-center gap-2 bg-gray-100 dark:bg-slate-700 rounded-lg p-1 flex-shrink-0">
                                    <button onclick="updateProductQty(${product.id}, -1)" class="w-8 h-8 flex items-center justify-center bg-white dark:bg-slate-600 rounded-md shadow-sm text-base hover:bg-red-50 dark:hover:bg-red-900 text-red-600 dark:text-red-400 font-bold transition-colors">‚àí</button>
                                    <span class="text-base font-bold w-6 text-center dark:text-white">${qty}</span>
                                    <button onclick="updateProductQty(${product.id}, 1)" class="w-8 h-8 flex items-center justify-center bg-white dark:bg-slate-600 rounded-md shadow-sm text-base hover:bg-green-50 dark:hover:bg-green-900 text-green-600 dark:text-green-400 font-bold transition-colors">+</button>
                                </div>
                                <button onclick="toggleCart()" class="flex-grow bg-[#D4AF37] text-white font-semibold py-2 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 shadow-sm hover:shadow-md hover:bg-[#b8962e]">
                                    View Cart <i data-lucide="shopping-bag" class="h-4 w-4"></i>
                                </button>
                            ` : `
                                <button onclick="addToCart(${product.id})" class="w-full bg-white/80 dark:bg-slate-700/80 backdrop-blur-sm border-2 border-[#D4AF37] text-[#996515] dark:text-amber-300 hover:bg-[#D4AF37] hover:text-white dark:hover:bg-[#D4AF37] dark:hover:text-white font-semibold py-2.5 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 shadow-sm hover:shadow-md">
                                    Add to Cart <i data-lucide="shopping-cart" class="h-4 w-4"></i>
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `}).join('');
            lucide.createIcons(); // Re-init icons for new elements
        }
        
        // Search and Filter Functions
        function filterProducts() {
            let filtered = products;
            
            // Filter by search term
            if (currentSearch) {
                const searchLower = currentSearch.toLowerCase();
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(searchLower) || 
                    p.desc.toLowerCase().includes(searchLower) ||
                    categoryLabels[p.category].toLowerCase().includes(searchLower)
                );
            }
            
            // Filter by category
            if (currentCategory !== 'all') {
                filtered = filtered.filter(p => p.category === currentCategory);
            }
            
            // Update UI
            updateFilterUI(filtered.length);
            renderProducts(filtered);
        }
        
        function updateFilterUI(count) {
            const hasFilters = currentSearch || currentCategory !== 'all';
            
            if (hasFilters) {
                activeFiltersDiv.classList.remove('hidden');
                activeFiltersDiv.classList.add('flex');
                
                let filterLabel = '';
                if (currentCategory !== 'all' && currentSearch) {
                    filterLabel = `"${currentSearch}" in ${categoryLabels[currentCategory]}`;
                } else if (currentCategory !== 'all') {
                    filterLabel = categoryLabels[currentCategory];
                } else {
                    filterLabel = `"${currentSearch}"`;
                }
                
                filterText.textContent = filterLabel;
                resultsCount.textContent = `(${count} product${count !== 1 ? 's' : ''})`;
            } else {
                activeFiltersDiv.classList.add('hidden');
                activeFiltersDiv.classList.remove('flex');
            }
            
            lucide.createIcons();
        }
        
        function clearFilters() {
            currentSearch = '';
            currentCategory = 'all';
            searchInput.value = '';
            categoryFilter.value = 'all';
            filterProducts();
        }
        
        // Event Listeners for Search and Filter
        searchInput.addEventListener('input', (e) => {
            currentSearch = e.target.value.trim();
            filterProducts();
        });
        
        categoryFilter.addEventListener('change', (e) => {
            currentCategory = e.target.value;
            filterProducts();
        });

        // Cart Functions
        function addToCart(id) {
            if (cart[id]) {
                cart[id]++;
            } else {
                cart[id] = 1;
            }
            saveCart(); // Persist to localStorage
            updateCartUI();
            filterProducts(); // Re-render products to show quantity controls
        }

        function removeFromCart(id) {
            delete cart[id];
            saveCart(); // Persist to localStorage
            updateCartUI();
            filterProducts(); // Re-render products to update quantity display
        }

        function changeQuantity(id, change) {
            if (cart[id] + change <= 0) {
                removeFromCart(id);
            } else {
                cart[id] += change;
                saveCart(); // Persist to localStorage
                updateCartUI();
            }
        }
        
        // Update quantity from product card (also re-renders products)
        function updateProductQty(id, change) {
            if (!cart[id]) cart[id] = 0;
            
            if (cart[id] + change <= 0) {
                delete cart[id];
            } else {
                cart[id] += change;
            }
            
            saveCart();
            updateCartUI();
            filterProducts(); // Re-render products to update quantity display
        }

        function updateCartUI() {
            const cartDrawerContainer = document.getElementById('cart-items-container');
            const cartCountBadge = document.getElementById('cart-count');
            const cartTotalEl = document.getElementById('cart-total');

            // 1. Calculate Total Items and Price
            let totalItems = 0;
            let totalPrice = 0;
            let cartHTML = '';

            const cartIds = Object.keys(cart);

            if (cartIds.length === 0) {
                cartHTML = `
                    <div class="text-center text-gray-400 dark:text-gray-500 mt-20 flex flex-col items-center">
                        <i data-lucide="shopping-cart" class="h-12 w-12 mb-2 opacity-50"></i>
                        <p>Your cart is empty.</p>
                        <button onclick="toggleCart()" class="text-[#2F5233] dark:text-green-400 font-bold text-sm mt-2 hover:underline">Start Browsing</button>
                    </div>`;
            } else {
                cartIds.forEach(id => {
                    const product = products.find(p => p.id == id);
                    const qty = cart[id];
                    const itemTotal = product.price * qty;
                    
                    totalItems += qty;
                    totalPrice += itemTotal;

                    cartHTML += `
                        <div class="bg-white dark:bg-slate-800 p-3 rounded-lg shadow-sm border border-gray-100 dark:border-slate-700 flex items-center gap-3">
                            <img src="${product.image}" class="w-16 h-16 rounded-md object-cover">
                            <div class="flex-grow">
                                <h4 class="font-bold text-sm text-gray-800 dark:text-gray-200 line-clamp-1">${product.name}</h4>
                                <div class="text-[#D4AF37] text-sm font-semibold">${CURRENCY}${product.price}</div>
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <div class="flex items-center gap-3 bg-gray-100 dark:bg-slate-700 rounded-xl p-1.5">
                                    <button onclick="changeQuantity(${id}, -1)" class="w-9 h-9 flex items-center justify-center bg-white dark:bg-slate-600 rounded-lg shadow-sm text-lg hover:bg-red-50 dark:hover:bg-red-900 text-red-600 dark:text-red-400 font-bold transition-colors">‚àí</button>
                                    <span class="text-base font-bold w-5 text-center dark:text-white">${qty}</span>
                                    <button onclick="changeQuantity(${id}, 1)" class="w-9 h-9 flex items-center justify-center bg-white dark:bg-slate-600 rounded-lg shadow-sm text-lg hover:bg-green-50 dark:hover:bg-green-900 text-green-600 dark:text-green-400 font-bold transition-colors">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // Update DOM
            cartDrawerContainer.innerHTML = cartHTML;
            cartTotalEl.innerText = `${CURRENCY}${totalPrice}`;
            
            cartCountBadge.innerText = totalItems;
            if (totalItems > 0) {
                cartCountBadge.classList.remove('scale-0');
            } else {
                cartCountBadge.classList.add('scale-0');
            }
            
            lucide.createIcons();
        }

        // Modal Toggle Logic
        const cartModal = document.getElementById('cart-modal');
        const cartDrawer = document.getElementById('cart-drawer');

        function toggleCart() {
            const isHidden = cartModal.classList.contains('hidden');
            
            if (isHidden) {
                // Open
                cartModal.classList.remove('hidden');
                // Small delay to allow display:block to apply before opacity transition
                setTimeout(() => {
                    cartModal.classList.remove('opacity-0');
                    cartDrawer.classList.remove('translate-x-full');
                }, 10);
            } else {
                // Close
                cartModal.classList.add('opacity-0');
                cartDrawer.classList.add('translate-x-full');
                setTimeout(() => {
                    cartModal.classList.add('hidden');
                }, 300);
            }
        }

        // Close modal when clicking outside drawer
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) toggleCart();
        });

        // WhatsApp Integration Functions
        let pendingWhatsAppMessage = '';
        let pendingAction = ''; // 'order' or 'consult'
        
        const userInfoModal = document.getElementById('user-info-modal');
        const userInfoDialog = document.getElementById('user-info-dialog');
        const userInfoForm = document.getElementById('user-info-form');
        const userNameInput = document.getElementById('user-name');
        const userAgeInput = document.getElementById('user-age');
        
        function showUserInfoModal(action) {
            pendingAction = action;
            userInfoModal.classList.remove('hidden');
            userInfoModal.classList.add('flex');
            
            setTimeout(() => {
                userInfoModal.classList.remove('opacity-0');
                userInfoDialog.classList.remove('scale-95');
                userInfoDialog.classList.add('scale-100');
                userNameInput.focus();
            }, 10);
        }
        
        function closeUserInfoModal() {
            userInfoModal.classList.add('opacity-0');
            userInfoDialog.classList.remove('scale-100');
            userInfoDialog.classList.add('scale-95');
            
            setTimeout(() => {
                userInfoModal.classList.add('hidden');
                userInfoModal.classList.remove('flex');
                userInfoForm.reset();
                pendingWhatsAppMessage = '';
                pendingAction = '';
            }, 300);
        }
        
        // Close modal when clicking outside
        userInfoModal.addEventListener('click', (e) => {
            if (e.target === userInfoModal) closeUserInfoModal();
        });
        
        // Handle form submission
        userInfoForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const userName = userNameInput.value.trim();
            const userAge = userAgeInput.value.trim();
            
            if (!userName || !userAge) {
                alert('Please fill in all fields');
                return;
            }
            
            let finalMessage = '';
            const isOrder = pendingAction === 'order';
            
            if (isOrder) {
                finalMessage = buildOrderMessage(userName, userAge);
            } else if (pendingAction === 'consult') {
                finalMessage = `${MSG_CONSULT}\n\nüë§ *Customer Details:*\nName: ${userName}\nAge: ${userAge}`;
            }
            
            closeUserInfoModal();
            
            // Small delay to let modal close animation complete
            setTimeout(() => {
                openWhatsApp(finalMessage);
                
                // Clear cart after order is placed
                if (isOrder) {
                    clearCart();
                    toggleCart(); // Close cart drawer
                }
            }, 350);
        });
        
        function buildOrderMessage(userName, userAge) {
            const cartIds = Object.keys(cart);
            let message = `${MSG_ORDER_PREFIX}\n\n`;
            message += `üë§ *Customer Details:*\nName: ${userName}\nAge: ${userAge}\n\n`;
            message += `üõí *Order Items:*\n`;
            
            let total = 0;

            cartIds.forEach(id => {
                const product = products.find(p => p.id == id);
                const qty = cart[id];
                const lineTotal = product.price * qty;
                total += lineTotal;
                
                message += `‚ñ™Ô∏è ${product.name}\n   Quantity: ${qty} x ${CURRENCY}${product.price} = ${CURRENCY}${lineTotal}\n\n`;
            });

            message += `*Total Amount: ${CURRENCY}${total}*`;
            
            return message;
        }
        
        function placeOrder() {
            const cartIds = Object.keys(cart);
            if (cartIds.length === 0) {
                alert("Your cart is empty!");
                return;
            }
            
            showUserInfoModal('order');
        }

        function openConsultation() {
            showUserInfoModal('consult');
        }

        function openWhatsApp(text) {
            const url = `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // Initialize
        loadCart(); // Restore cart from localStorage FIRST
        updateCartUI(); // Update cart display
        renderProducts(); // Then render products with correct cart state

    </script>
</body>
</html>